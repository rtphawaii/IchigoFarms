{% extends "store/base.html" %}
{% load money %}

{% block title %}Products Â· Ikigai Candles{% endblock %}

{% block content %}

<div class="grid grid-cols-1 md:grid-cols-3 gap-6">

{% for product in products %}

  <a href="{% url 'product_detail' product.slug %}"
     class="group block border border-black/10 bg-white/80 backdrop-blur-md p-5 shadow hover:bg-black/5 transition">

    {# --- Image area (primary + hover) --- #}
    {% with imgs=product.images.all %}
      <div class="aspect-[4/3] mb-4 border border-black/10 overflow-hidden bg-black/5 relative">

        {# Primary image: imgs[0] else product.image #}
        {% if imgs and imgs.0.is_active %}
          <img
            src="{{ imgs.0.image.url }}"
            alt="{{ imgs.0.alt_text|default:product.name }}"
            class="absolute inset-0 h-full w-full object-cover transition-opacity duration-300 {% if imgs|length > 1 %}opacity-100 group-hover:opacity-0{% endif %}"
          />
        {% elif product.image %}
          <img
            src="{{ product.image.url }}"
            alt="{{ product.name }}"
            class="absolute inset-0 h-full w-full object-cover"
          />
        {% endif %}

        {# Hover image: imgs[1] if exists #}
        {% if imgs|length > 1 and imgs.1.is_active %}
          <img
            src="{{ imgs.1.image.url }}"
            alt="{{ imgs.1.alt_text|default:product.name }}"
            class="absolute inset-0 h-full w-full object-cover opacity-0 transition-opacity duration-300 group-hover:opacity-100"
          />
        {% endif %}

      </div>
    {% endwith %}

    <h2 class="text-lg font-semibold tracking-tight text-slate-900">
      {{ product.name }}
    </h2>

    <div class="mt-2 text-sm font-semibold text-slate-800">
      {{ product.price_cents|money }}
    </div>

    <!-- Scent profile -->
    <div class="mt-3 text-xs text-slate-700 space-y-1 leading-snug">
      {% if product.scent_top %}
        <div><span class="font-semibold">Top:</span> {{ product.scent_top }}</div>
      {% endif %}
      {% if product.scent_mid %}
        <div><span class="font-semibold">Mid:</span> {{ product.scent_mid }}</div>
      {% endif %}
      {% if product.scent_base %}
        <div><span class="font-semibold">Base:</span> {{ product.scent_base }}</div>
      {% endif %}
    </div>

    <!-- Inventory badge -->
    {% if product.inventory and product.inventory.stock_on_hand <= 5 %}
      <div class="mt-3 text-xs font-semibold text-amber-800">
        Only {{ product.inventory.stock_on_hand }} left
      </div>
    {% endif %}

  </a>

{% endfor %}

</div>

{% endblock %}
